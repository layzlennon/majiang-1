// Generated by CoffeeScript 1.12.5
cc.Class({
    "extends": cc.Component,
    properties: {
        quitButtonSprite: {
            "default": null,
            type: cc.SpriteFrame
        },
        quitButton: {
            "default": null,
            type: cc.Button
        },
        _tilesNode: null,
        _juShuZhangShu: null
    },
    onLoad: function() {
        var argetSprite;
        this.addComponent("Alert");
        this.addComponent("Dissolve");
        this.addComponent("Setting");
        this.initEventHandlers();
        this.onGameBeign();
        if (cc.director.TableGlobalData.isHostUser()) {
            argetSprite = this.quitButton.getComponent(cc.Sprite);
            argetSprite.spriteFrame = this.quitButtonSprite;
        }
        // this.onInitStart();
        if(!cc.director.TableGlobalData.getGameIn())
        {
            cc.director.TableGlobalData.setGameIn(true);
            this.start();
        }


    },
    start: function() {
        console.log("mjGameScene .........");
        if (cc.director.TableGlobalData.getGameIn())
        {
            var seats = cc.director.TableGlobalData.getSeats();
            for (var i = 0; i < seats.length; i++)
            {
                if (seats[i].userid > 0)
                {
                    var localIndex = cc.director.TableGlobalData.getLocalIndex(seats[i].seatindex);
                    console.log("localIndex : " + localIndex);
                    cc.director.GlobalEvent.emit("refresh_all", {
                        seatId: localIndex
                    });
                }
            }
        }
    },
    clickQuitBtn:function () {
        if (cc.director.TableGlobalData.isHostUser()) {
            this.onBtnDissolve();
        } else {
            return cc.vv.net.send("exit");
        }
    },
    onBtnDissolve:function ()
    {
        var fn = function()
        {
            cc.vv.net.send("dispress");
        };
        cc.vv.alert.show("解散房间", "解散房间不扣房卡，是否确定解散？", fn, true);

    },
    initEventHandlers: function() {
        cc.vv.gameNetMgr.dataEventHandler = this.node;

        // cc.director.GlobalEvent.on("game_begin", this.onGameBeign, this);
    },
    onGameBeign: function() {
        var component;
        console.log("onGameBeign: ");
        component = cc.find("Canvas/HeadTileInfo/TableNoLabel");
        this.tableNoLabel = component.getComponent(cc.Label);
        this.tableNoLabel.string = "房间: " + cc.director.TableGlobalData.getRoomId();
    },
    showSettingUI: function() {
        if (cc.vv.setting) {
            cc.vv.setting.showSetting();
        }
    },
    update: function(dt) {}
});

//# sourceMappingURL=MjGameScene.js.map
